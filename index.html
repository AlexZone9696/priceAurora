<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Поиск цены товара</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    input, select { padding: 10px; font-size: 16px; margin-top: 10px; width: 100%; }
    .suggestions { border: 1px solid #ccc; max-height: 200px; overflow-y: auto; }
    .suggestion-item { padding: 10px; cursor: pointer; }
    .suggestion-item:hover { background: #f0f0f0; }
  </style>
</head>
<body>

<h2>Загрузка файла Excel</h2>
<input type="file" id="file-input" accept=".xlsx,.xls">

<h2>Поиск товара</h2>
<input type="text" id="search-input" placeholder="Введите наименование товара..." disabled>
<div id="suggestions" class="suggestions"></div>

<h3 id="price-output"></h3>

<script>
  let products = [];

  document.getElementById('file-input').addEventListener('change', function(e) {
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = function(evt) {
      const data = new Uint8Array(evt.target.result);
      const workbook = XLSX.read(data, { type: 'array' });
      const sheet = workbook.Sheets[workbook.SheetNames[0]];
      const jsonData = XLSX.utils.sheet_to_json(sheet);

      // Сохраняем только необходимые столбцы
      products = jsonData.map(row => ({
        name: row['Наименование'],
        price: row['Цена розница']
      })).filter(p => p.name && p.price); // убираем пустые

      document.getElementById('search-input').disabled = false;
      alert('Файл загружен, можно искать!');
    };
    reader.readAsArrayBuffer(file);
  });

  document.getElementById('search-input').addEventListener('input', function() {
    const input = this.value.toLowerCase();
    const suggestions = products.filter(p => p.name.toLowerCase().includes(input)).slice(0, 10);

    const suggestionBox = document.getElementById('suggestions');
    suggestionBox.innerHTML = '';

    suggestions.forEach(s => {
      const item = document.createElement('div');
      item.className = 'suggestion-item';
      item.textContent = `${s.name} — ${s.price}₸`;
      item.addEventListener('click', () => {
        document.getElementById('search-input').value = s.name;
        document.getElementById('price-output').textContent = `Цена: ${s.price}₸`;
        suggestionBox.innerHTML = '';
      });
      suggestionBox.appendChild(item);
    });

    if (suggestions.length === 0) {
      document.getElementById('price-output').textContent = '';
    }
  });
</script>

</body>
</html>
